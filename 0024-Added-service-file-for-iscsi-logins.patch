From 666694ed3654e333751af0897c8b71f8cc1829f8 Mon Sep 17 00:00:00 2001
From: Lee Duncan <lduncan@suse.com>
Date: Tue, 16 Oct 2018 13:53:09 -0700
Subject: [PATCH] Added service file for iscsi logins

This service file layers on top of iscsid.serivce
to manage logging into and out of known targets.
---
 etc/systemd/iscsi.service | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 etc/systemd/iscsi.service

diff --git a/etc/systemd/iscsi.service b/etc/systemd/iscsi.service
new file mode 100644
index 0000000..0edcf51
--- /dev/null
+++ b/etc/systemd/iscsi.service
@@ -0,0 +1,17 @@
+[Unit]
+Description=Login and scanning of iSCSI devices
+Documentation=man:iscsiadm(8) man:iscsid(8)
+Before=remote-fs.target
+After=network.target network-online.target iscsid.service
+ConditionPathExists=/etc/iscsi/initiatorname.iscsi
+
+[Service]
+Type=oneshot
+ExecStart=-/sbin/iscsiadm -m node --loginall=automatic
+ExecStop=/sbin/iscsiadm -m node --logoutall=automatic
+ExecStop=/sbin/iscsiadm -m node --logoutall=manual
+SuccessExitStatus=21
+RemainAfterExit=true
+
+[Install]
+WantedBy=remote-fs.target
-- 
1.8.3.1

